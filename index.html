<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="sharedoc.css">
        <script src="sharedoc.js"></script>

        <title>Payperclip Sharedoc</title>
    </head>

    <body>
        <div class="register-login-container">
            <img src="Company Logo.png" alt="Payperclip Sharedoc" width="25%" height="25%">

            <div class="login-container">
                <h1>Login</h1>
                
                <form id="loginForm">
                    <div class="register-login-input">
                        <input type="text" id="signup-email" placeholder="E-Mail Address">
                        
                        <input type="password" id="signup-original-password" placeholder="Password">

                        <div class="register-login-buttons">
                            <a href="/register.html">
                                <button type="button">Register</button>
                            </a>
                            <button id="loginButton" type="submit">Login</button>
                        </div>

                        <button><a href="#" class="dark-mode-button">Dark Mode</a></button>

                        <a href="/forgottenpassword.html">Forgotten Password?</a>
                    </div>
                </form>
            </div>
        </div>

        <footer>
            <div class="footer-text">
                <h3>Footer placeholder text</h3>
            </div>
            
            <div class="links">
                <a href="www.google.com" target="_blank">Placeholder link 1</a>
                <a href="www.google.com" target="_blank">Placeholder link 2</a>
                <a href="www.google.com" target="_blank">Placeholder link 3</a>
                <a href="www.google.com" target="_blank">Placeholder link 4</a>
            </div>
        </footer>
    </body>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getDatabase, get, ref, child } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
      
        const firebaseConfig = {
          apiKey: "AIzaSyAZo8CAqAyo2T-lijmHCQdq-_9W_-0rkGA",
          authDomain: "payperclip-d7e18.firebaseapp.com",
          databaseURL: "https://payperclip-d7e18-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "payperclip-d7e18",
          storageBucket: "payperclip-d7e18.appspot.com",
          messagingSenderId: "896354782092",
          appId: "1:896354782092:web:5edcc35ed31cc5c70264a9",
        };
      
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth(app);
        const dbref = ref(db);

        let emailInput = document.getElementById("signup-email");
        let passwordOriginalInput = document.getElementById("signup-original-password");

        let SignInUser = evt => {
            evt.preventDefault();

            signInWithEmailAndPassword(auth, emailInput.value, passwordOriginalInput.value)
            .then((credentials) => {
                get(child(dbref, "UsersAuthList/ " + credentials.user.uid)).then((snapshot) => {
                    if(snapshot.exists) {
                        sessionStorage.setItem("user-info", JSON.stringify({
                            firstname: snapshot.val().firstname,
                            lastname: snapshot.val().lastname
                        }))
                        sessionStorage.setItem("user-creds", JSON.stringify(credentials.user));
                        window.location.href = "/announcements-student.html";
                    }
                })
            })
            .catch((error) => {
                alert(error.message);
                console.log(error.code);
                console.log(error.message);
            })
        }

        loginForm.addEventListener("submit", SignInUser);
    </script>
</html>
	